<!doctype html>
<html lang="bg">
<head>
  <meta charset="utf-8" />
  <title>–°–≤–µ—Ç–∫–∞–≤–∏—á–µ–Ω –∫—É–∏–∑ ‚ö°</title>
<link rel="manifest" href="manifest.json">
<script>
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('service-worker.js');
}
</script>
  <style>
    body { font-family: Arial, sans-serif; max-width: 720px; margin: 40px auto; line-height: 1.6; }
    h1 { text-align: center; }
    #question { font-size: 1.3em; margin-bottom: 20px; }
    .answers button {
      display: block;
      width: 100%;
      margin: 8px 0;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 6px;
      cursor: pointer;
      font-size: 1em;
      background: #f5f5f5;
      transition: background 0.3s;
    }
    .answers button:hover { background: #e0e0e0; }
    .answers button.correct { background: #c8e6c9; border-color: #4caf50; }
    .answers button.wrong { background: #ffcdd2; border-color: #f44336; }
    #status { margin-top: 10px; font-weight: bold; }
    #timer { text-align: right; font-weight: bold; margin-bottom: 10px; }
    #next-btn { margin-top: 20px; padding: 8px 14px; font-size: 1em; }
    ul { padding-left: 20px; }
    #start-screen { text-align: center; margin-top: 40px; }
    input { padding: 8px; font-size: 1em; width: 70%; max-width: 300px; }
    button.start, button.show { margin-top: 15px; padding: 10px 16px; font-size: 1em; }
  </style>
</head>
<body>
  <h1>‚ö° –°–≤–µ—Ç–∫–∞–≤–∏—á–µ–Ω –∫—É–∏–∑ ‚ö°</h1>

  <div id="start-screen">
    <p>–í—ä–≤–µ–¥–µ—Ç–µ –∏–º–µ—Ç–æ –Ω–∞ –≤–∞—à–∏—è –æ—Ç–±–æ—Ä, –∑–∞ –¥–∞ –∑–∞–ø–æ—á–Ω–µ—Ç–µ –∏–≥—Ä–∞—Ç–∞:</p>
    <input type="text" id="player-name" placeholder="–ò–º–µ –Ω–∞ –æ—Ç–±–æ—Ä–∞..." />
    <br>
    <button class="start" id="start-btn">–ó–∞–ø–æ—á–Ω–∏!</button>
    <br>
    <button class="show" id="show-last-btn">–ü–æ–∫–∞–∂–∏ –ø–æ—Å–ª–µ–¥–µ–Ω —Ä–µ–∑—É–ª—Ç–∞—Ç</button>
    <div id="last-result" style="margin-top:20px;"></div>
  </div>

  <div id="quiz" style="display:none;">
    <div id="timer">–û—Å—Ç–∞–≤–∞—â–æ –≤—Ä–µ–º–µ: 15 —Å–µ–∫.</div>
    <div id="question"></div>
    <div id="answers" class="answers"></div>
    <div id="status"></div>
    <button id="next-btn" disabled>–°–ª–µ–¥–≤–∞—â –≤—ä–ø—Ä–æ—Å</button>
  </div>

  <script>
  (async function(){
    const startScreen = document.getElementById('start-screen');
    const playerInput = document.getElementById('player-name');
    const startBtn = document.getElementById('start-btn');
    const showLastBtn = document.getElementById('show-last-btn');
    const lastResultDiv = document.getElementById('last-result');

    const qText = document.getElementById('question');
    const answersDiv = document.getElementById('answers');
    const nextBtn = document.getElementById('next-btn');
    const status = document.getElementById('status');
    const timerDisplay = document.getElementById('timer');
    const quizDiv = document.getElementById('quiz');

    let playerName = '';
    let questions = [];
    let idx = 0;
    let score = 0;
    let timeLeft = 15;
    let timer;

    // –ó–∞—Ä–µ–∂–¥–∞–Ω–µ –Ω–∞ –≤—ä–ø—Ä–æ—Å–∏—Ç–µ
    try {
      const res = await fetch('questions.json');
      questions = await res.json();
    } catch(err) {
      qText.textContent = '–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –∑–∞—Ä–µ–∂–¥–∞–Ω–µ –Ω–∞ –≤—ä–ø—Ä–æ—Å–∏—Ç–µ.';
      console.error(err);
      return;
    }

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞ –ø–æ—Å–ª–µ–¥–µ–Ω —Ä–µ–∑—É–ª—Ç–∞—Ç –ø—Ä–∏ –∑–∞—Ä–µ–∂–¥–∞–Ω–µ
    const last = JSON.parse(localStorage.getItem('lastResult'));
    if (last) {
      lastResultDiv.innerHTML = `<b>–ü–æ—Å–ª–µ–¥–µ–Ω —Ä–µ–∑—É–ª—Ç–∞—Ç:</b><br>${last.name} ‚Äî ${last.score}/${last.total} (${last.percent}%)<br><small>${last.date}</small>`;
    }

    function normalize(s){ return String(s).trim(); }

    function startTimer(){
      clearInterval(timer);
      timeLeft = 15; // ‚è± –ø—Ä–æ–º–µ–Ω–∏ —Ç—É–∫ –≤—Ä–µ–º–µ—Ç–æ –∑–∞ –≤—Å–µ–∫–∏ –≤—ä–ø—Ä–æ—Å
      timerDisplay.textContent = `–û—Å—Ç–∞–≤–∞—â–æ –≤—Ä–µ–º–µ: ${timeLeft} —Å–µ–∫.`;
      timer = setInterval(()=>{
        timeLeft--;
        timerDisplay.textContent = `–û—Å—Ç–∞–≤–∞—â–æ –≤—Ä–µ–º–µ: ${timeLeft} —Å–µ–∫.`;
        if (timeLeft <= 0) {
          clearInterval(timer);
          lockAnswers();
          status.textContent = '‚è∞ –í—Ä–µ–º–µ—Ç–æ –∏–∑—Ç–µ—á–µ!';
          nextBtn.disabled = false;
        }
      },1000);
    }

    function lockAnswers(){
      Array.from(answersDiv.children).forEach(btn => btn.disabled = true);
    }

    function renderQuestion(i){
      const q = questions[i];
      qText.textContent = `${i+1}. ${q.question}`;
      answersDiv.innerHTML = '';
      status.textContent = '';
      nextBtn.disabled = true;

      q.answers.forEach(ans => {
        const btn = document.createElement('button');
        btn.textContent = ans;
        btn.onclick = ()=>{
          lockAnswers();
          clearInterval(timer);
          const correct = normalize(q.correct);
          const chosen = normalize(ans);
          if (chosen === correct) {
            btn.classList.add('correct');
            status.textContent = '‚úÖ –í–µ—Ä–µ–Ω –æ—Ç–≥–æ–≤–æ—Ä!';
            score++;
          } else {
            btn.classList.add('wrong');
            status.textContent = `‚ùå –ì—Ä–µ—à–µ–Ω. –í–µ—Ä–Ω–∏—è—Ç –æ—Ç–≥–æ–≤–æ—Ä –µ: ${q.correct}`;
            Array.from(answersDiv.children).forEach(b=>{
              if (normalize(b.textContent) === correct) b.classList.add('correct');
            });
          }
          nextBtn.disabled = false;
        };
        answersDiv.appendChild(btn);
      });

      startTimer();
    }

    nextBtn.addEventListener('click', ()=>{
      idx++;
      if (idx >= questions.length) {
        clearInterval(timer);
        const percent = Math.round((score / questions.length) * 100);
        const resultText = `üèÅ –ö—Ä–∞–π –Ω–∞ —Ç–µ—Å—Ç–∞, <b>${playerName}</b>!<br><br>–†–µ–∑—É–ª—Ç–∞—Ç: <b>${score}</b> –æ—Ç <b>${questions.length}</b> (${percent}%).`;

        // üíæ –ó–∞–ø–∏—Å–≤–∞–º–µ –ø–æ—Å–ª–µ–¥–Ω–∏—è —Ä–µ–∑—É–ª—Ç–∞—Ç
        const record = { name: playerName, score, total: questions.length, percent, date: new Date().toLocaleString('bg-BG') };
        localStorage.setItem('lastResult', JSON.stringify(record));

        qText.innerHTML = resultText;
        answersDiv.innerHTML = '';
        status.textContent = '';
        nextBtn.disabled = true;
        timerDisplay.textContent = '';
        return;
      }
      renderQuestion(idx);
    });

    startBtn.addEventListener('click', ()=>{
      playerName = playerInput.value.trim();
      if (!playerName) {
        alert('–ú–æ–ª—è, –≤—ä–≤–µ–¥–µ—Ç–µ –∏–º–µ –Ω–∞ –æ—Ç–±–æ—Ä–∞.');
        return;
      }
      startScreen.style.display = 'none';
      quizDiv.style.display = 'block';
      renderQuestion(0);
    });

    showLastBtn.addEventListener('click', ()=>{
      const last = JSON.parse(localStorage.getItem('lastResult'));
      if (last) {
        lastResultDiv.innerHTML = `<b>–ü–æ—Å–ª–µ–¥–µ–Ω —Ä–µ–∑—É–ª—Ç–∞—Ç:</b><br>${last.name} ‚Äî ${last.score}/${last.total} (${last.percent}%)<br><small>${last.date}</small>`;
      } else {
        lastResultDiv.innerHTML = '–ù—è–º–∞ –∑–∞–ø–∏—Å–∞–Ω —Ä–µ–∑—É–ª—Ç–∞—Ç.';
      }
    });
  })();
  </script>
</body>
</html>
