<!doctype html>
<html lang="bg">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>‚ö° –ò–≥—Ä–∏ –Ω–∞ –ó–Ω–∞–Ω–∏—è - –°–≤–µ—Ç–∫–∞–≤–∏—á–µ–Ω –∫—É–∏–∑ ‚ö°</title>

  <link rel="manifest" href="manifest.json">

  <script>
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('service-worker.js');
  }
  </script>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-PK66NTHPN8"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-PK66NTHPN8');
</script>
  <style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  html, body { width: 100%; height: 100%; overflow-x: hidden; overflow-y: auto; }

  body {
    display: flex; flex-direction: column;
    align-items: center; justify-content: flex-start;
    font-size: 18px; font-family: 'Segoe UI', Arial, sans-serif;
    max-width: 900px; margin: 0 auto; padding: 20px;
     background: #00264d;   /* ‚Üê –¢–£–ö */
     color: #ffffff;   
  }

  h1 {
    text-align: center; color: #ffd100;
    font-size: clamp(1.5em, 4vw, 2em);
    margin: 10px auto 15px auto;
    text-shadow: 0 0 5px #ffb400;
  }

  #quiz, #start-screen {
    width: 100%; max-width: 600px; text-align: center;
    margin-top: 30px;
    background: rgba(255,255,255,0.05);
    border-radius: 16px; padding: 20px;
    box-shadow: 0 0 10px rgba(255,209,0,0.2);
  }

  #question { font-size: 1.6em; margin: 20px 0; font-weight: 600; }

  .answers button {
    display: block; width: 100%; margin: 10px 0; padding: 16px;
    border: none; border-radius: 10px; cursor: pointer;
    font-size: 1.2em; background: #333; color: #fff;
    transition: 0.2s;
  }

  .answers button:hover { background: #444; transform: scale(1.02); }
  .answers button.correct { background: #2e7d32; }
  .answers button.wrong { background: #b71c1c; }

  #timer {
    text-align: center; font-weight: 800; margin: 20px 0;
    font-size: clamp(1.8em, 5vw, 2.6em);
    color: #ffeb3b; text-shadow: 0 0 12px #ffcc00;
  }
  #timer.warning { color: #ff4c4c; }

  #status { margin-top: 10px; font-weight: bold; min-height: 30px; }

  #next-btn {
    margin-top: 25px; padding: 12px 18px; font-size: 1.1em;
    border: none; border-radius: 8px;
    background: #ffd100; color: #111; font-weight: bold; cursor: pointer;
  }
  #next-btn:hover { background:#ffcc33; transform:scale(1.05); }

  input {
    padding: 10px; font-size: 1.1em; border-radius: 8px;
    border: 1px solid #ccc; width: 80%; margin-bottom: 10px;
  }

  button.start, button.continue-btn {
    margin-top: 10px; padding: 12px 20px; font-size: 1.1em;
    border-radius: 8px; border: none;
    background: #ffd100; color: #111; font-weight: bold; cursor: pointer;
  }
  button.start:hover, button.continue-btn:hover {
    background:#ffcc33; transform:scale(1.05);
  }

  #current-score {
    margin: 15px 0; font-size: 1.3em;
    color: #ffd100; font-weight: bold; display: none;
  }

  #explanation {
    display:none; background:rgba(255,255,255,0.08);
    padding:20px; margin-top:20px;
    border-radius:12px; max-width:600px; text-align:center;
  }

  #explanation .button-row {
    display:flex; justify-content:center; gap:12px; margin-top:20px;
  }

  .yellow-btn {
    background:#ffd100; color:#111;
    padding:14px 22px; font-size:1.1em;
    border-radius:10px; border:none; font-weight:bold; cursor:pointer;
  }
  .yellow-btn:hover { background:#ffcc33; transform:scale(1.05); }
    #timer {
  text-align: center;
  font-weight: 800;
  color: #ffeb3b;
  margin: 20px 0;
  font-size: clamp(1.8em, 5vw, 2.6em);
  text-shadow: 0 0 12px #ffcc00, 0 0 20px #ffcc00;
  letter-spacing: 1px;
}

#seconds {
  display: inline-block;
  min-width: 70px; /* –≥–∞—Ä–∞–Ω—Ç–∏—Ä–∞, —á–µ 9 —Å–µ–∫. –∏ 20 —Å–µ–∫. –∑–∞–µ–º–∞—Ç –µ–¥–Ω–∞–∫–≤–æ –º—è—Å—Ç–æ */
  text-align: center;
}
  </style>
</head>

<body>
<audio id="bg-music" src="music.mp3" loop preload="auto"></audio>

<h1>–ò–≥—Ä–∏ –Ω–∞ –ó–Ω–∞–Ω–∏—è<br>‚ö° –°–≤–µ—Ç–∫–∞–≤–∏—á–µ–Ω –∫—É–∏–∑ ‚ö°<br>‚ö° –µ–ø–∏–∑–æ–¥ 31 ‚ö°</h1>

<div id="start-screen">
  <p>–í—ä–≤–µ–¥–µ—Ç–µ –í–∞—à–µ—Ç–æ –∏–º–µ:</p>

  <input type="text" id="player-name" placeholder="–ò–º–µ ..." /><br>

  <button class="start" id="start-btn">–ó–∞–ø–æ—á–Ω–∏!</button><br>

  <button class="continue-btn" id="continue-btn" style="display:none;">
    –ü—Ä–æ–¥—ä–ª–∂–∏ –æ—Ç –º—è—Å—Ç–æ—Ç–æ, –∫—ä–¥–µ—Ç–æ —Å–ø—Ä—è—Ö—Ç–µ
  </button>

  <div id="last-result" style="margin-top:15px;"></div>
</div>

<div id="quiz" style="display:none;">
 <div id="timer">
  <span class="label">–û—Å—Ç–∞–≤–∞—â–æ –≤—Ä–µ–º–µ:</span>
  <span id="seconds">20 —Å–µ–∫.</span>
</div>
  <div id="question"></div>
  <div id="answers" class="answers"></div>
  <div id="status"></div>
  <button id="next-btn" disabled>–°–ª–µ–¥–≤–∞—â –≤—ä–ø—Ä–æ—Å</button>
  <div id="current-score"></div>
</div>

<div id="explanation">
  <div id="explanation-text" style="font-size:1.2em; margin-bottom:20px;"></div>

  <div class="button-row">
    <button id="next-question-btn" class="yellow-btn">–°–ª–µ–¥–≤–∞—â –≤—ä–ø—Ä–æ—Å</button>
    <button id="close-explanation-btn" class="yellow-btn">–ó–∞—Ç–≤–æ—Ä–∏</button>
  </div>
</div>

<script>
(async function(){

const startScreen = document.getElementById('start-screen');
const playerInput = document.getElementById('player-name');
const startBtn = document.getElementById('start-btn');
const continueBtn = document.getElementById('continue-btn');
const lastResultDiv = document.getElementById('last-result');

const qText = document.getElementById('question');
const answersDiv = document.getElementById('answers');
const nextBtn = document.getElementById('next-btn');
const status = document.getElementById('status');
const timerDisplay = document.getElementById('timer');
const currentScoreDiv = document.getElementById('current-score');

const quizDiv = document.getElementById('quiz');
const explanationDiv = document.getElementById('explanation');
const explanationText = document.getElementById('explanation-text');
const bgMusic = document.getElementById("bg-music");

let playerName = '';
let questions = [];
let idx = 0;
let score = 0;
let timeLeft = 20;
let timer;

// –ò—Å—Ç–æ—Ä–∏—è
let gameHistory = [];

function showHistoryScreen() {
  quizDiv.style.display = "none";
  explanationDiv.style.display = "none";
  startScreen.style.display = "none";

  let historyDiv = document.getElementById("history-screen");
  if (!historyDiv) {
    historyDiv = document.createElement("div");
    historyDiv.id = "history-screen";
    historyDiv.style.padding = "20px";
    historyDiv.style.maxWidth = "600px";
    historyDiv.style.marginTop = "20px";
    historyDiv.style.background = "rgba(255,255,255,0.08)";
    historyDiv.style.borderRadius = "12px";
    historyDiv.style.textAlign = "left";

    document.body.appendChild(historyDiv);
  }

  historyDiv.innerHTML = "<h2>üìò –ò—Å—Ç–æ—Ä–∏—è –Ω–∞ –∏–≥—Ä–∞—Ç–∞</h2><br>";

  gameHistory.forEach((h, i) => {
    historyDiv.innerHTML += `
      <div style="margin-bottom:20px; padding-bottom:10px; border-bottom:1px solid #444;">
        <b>${i+1}. ${h.question}</b><br><br>
        –¢–≤–æ—è—Ç –æ—Ç–≥–æ–≤–æ—Ä: <span style="color:${h.correct?'#2ecc71':'#e74c3c'}">${h.yourAnswer}</span><br>
        –í–µ—Ä–µ–Ω –æ—Ç–≥–æ–≤–æ—Ä: <b style="color:#2ecc71">${h.correctAnswer}</b><br>
        <div style="margin-top:10px;color:#ddd"><i>${h.explanation}</i></div>
      </div>
    `;
  });

  historyDiv.innerHTML += `
    <button id="retry2-btn" class="yellow-btn" style="margin-top:20px;">–û–ø–∏—Ç–∞–π –ø–∞–∫</button>
  `;

  document.getElementById("retry2-btn").onclick = restartGame;
}

function restartGame() {
  localStorage.removeItem("progress");
  location.reload();
}

// –ó–∞—Ä–µ–∂–¥–∞–Ω–µ –Ω–∞ –≤—ä–ø—Ä–æ—Å–∏
try {
  const res = await fetch('questions.json');
  questions = await res.json();
} catch(e) {
  qText.textContent = "–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –∑–∞—Ä–µ–∂–¥–∞–Ω–µ –Ω–∞ –≤—ä–ø—Ä–æ—Å–∏—Ç–µ.";
  return;
}

// –ü–æ—Å–ª–µ–¥–µ–Ω —Ä–µ–∑—É–ª—Ç–∞—Ç
const last = JSON.parse(localStorage.getItem('lastResult'));
if (last) {
  lastResultDiv.innerHTML =
    `<b>–ü–æ—Å–ª–µ–¥–µ–Ω —Ä–µ–∑—É–ª—Ç–∞—Ç:</b><br>${last.name} ‚Äî ${last.score}/${last.total} (${last.percent}%)<br>
     <small>${last.date}</small>`;
}

// –ü—Ä–æ–¥—ä–ª–∂–∞–≤–∞–Ω–µ –Ω–∞ –∏–≥—Ä–∞
const saved = JSON.parse(localStorage.getItem('progress'));
if (saved && saved.idx < questions.length) {
  continueBtn.style.display = "inline-block";
  continueBtn.textContent = `–ü—Ä–æ–¥—ä–ª–∂–∏ –æ—Ç –≤—ä–ø—Ä–æ—Å ${saved.idx + 1}`;
}

function normalize(s){ return String(s).trim(); }

// –¢–∞–π–º–µ—Ä
function startTimer() {
  clearInterval(timer);
  timeLeft = 20;
  document.getElementById("seconds").textContent = `${timeLeft} —Å–µ–∫.`;
  timerDisplay.classList.remove("warning");

  timer = setInterval(() => {
    timeLeft--;
    document.getElementById("seconds").textContent = `${timeLeft} —Å–µ–∫.`;
    if (timeLeft <= 5) timerDisplay.classList.add("warning");

    if (timeLeft <= 0) {
      clearInterval(timer);
      lockAnswers();
      status.textContent = "‚è∞ –í—Ä–µ–º–µ—Ç–æ –∏–∑—Ç–µ—á–µ!";
      nextBtn.disabled = false;
    }
  }, 1000);
}

function lockAnswers() {
  Array.from(answersDiv.children).forEach(b => b.disabled = true);
}

// –†–µ–Ω–¥–µ—Ä –Ω–∞ –≤—ä–ø—Ä–æ—Å
function shuffleArray(arr) {
  for (let i = arr.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [arr[i], arr[j]] = [arr[j], arr[i]];
  }
  return arr;
}

function renderQuestion(i) {
  const q = questions[i];

  qText.textContent = `${i+1}. ${q.question}`;
  answersDiv.innerHTML = "";
  status.textContent = "";
  nextBtn.disabled = true;
  explanationDiv.style.display = "none";

  currentScoreDiv.style.display = "none";

// üî• –†–∞–∑–±—ä—Ä–∫–≤–∞–º–µ –æ—Ç–≥–æ–≤–æ—Ä–∏—Ç–µ
const shuffledAnswers = shuffleArray([...q.answers]);

 shuffledAnswers.forEach(ans => {
    const btn = document.createElement("button");
    btn.textContent = ans;

    btn.onclick = () => {
      lockAnswers();
      clearInterval(timer);

      const correct = normalize(q.correct);
      const chosen = normalize(ans);

      if (chosen === correct) {
        btn.classList.add("correct");
        status.textContent = "‚úÖ –í–µ—Ä–µ–Ω –æ—Ç–≥–æ–≤–æ—Ä!";
        score++;
      } else {
        btn.classList.add("wrong");
        status.textContent = `‚ùå –ì—Ä–µ—à–Ω–æ! –í–µ—Ä–Ω–∏—è—Ç –æ—Ç–≥–æ–≤–æ—Ä –µ: ${q.correct}`;
        Array.from(answersDiv.children).forEach(b => {
          if (normalize(b.textContent) === correct) b.classList.add("correct");
        });
      }

      gameHistory.push({
        question: q.question,
        yourAnswer: ans,
        correctAnswer: q.correct,
        correct: chosen === correct,
        explanation: q.explanation
      });

      currentScoreDiv.textContent = `–¢–µ–∫—É—â —Ä–µ–∑—É–ª—Ç–∞—Ç: ${score} —Ç–æ—á–∫–∏`;
      currentScoreDiv.style.display = "block";

      explanationText.innerHTML = q.explanation;
      explanationDiv.style.display = "block";

      nextBtn.disabled = false;

      localStorage.setItem("progress", JSON.stringify({
        name: playerName,
        idx: i,
        score
      }));
    };

    answersDiv.appendChild(btn);
  });

  startTimer();
}

// –ü—Ä–æ–¥—ä–ª–∂–∏ –∏–≥—Ä–∞
continueBtn.onclick = () => {
  try { bgMusic.play(); } catch(e){}
  playerName = saved.name;
  idx = saved.idx;
  score = saved.score;

  startScreen.style.display = "none";
  quizDiv.style.display = "block";
  renderQuestion(idx);
};

// –°—Ç–∞—Ä—Ç
startBtn.onclick = () => {
  try { bgMusic.play(); } catch(e){}
  playerName = playerInput.value.trim();
  if (!playerName) return alert("–í—ä–≤–µ–¥–µ—Ç–µ –∏–º–µ!");

  localStorage.removeItem("progress");

  startScreen.style.display = "none";
  quizDiv.style.display = "block";
  
  idx = 0;
  score = 0;

  renderQuestion(0);
};

// –°–ª–µ–¥–≤–∞—â –≤—ä–ø—Ä–æ—Å –æ—Ç –±—É—Ç–æ–Ω
nextBtn.onclick = nextQuestionFromExplanation;
document.getElementById("next-question-btn").onclick = nextQuestionFromExplanation;

function nextQuestionFromExplanation() {
  explanationDiv.style.display = "none";
  idx++;

  if (idx >= questions.length) return finishGame();

  renderQuestion(idx);
}

function finishGame() {
  clearInterval(timer);

  const percent = Math.round(score / questions.length * 100);

  qText.innerHTML =
    `üèÅ –ö—Ä–∞–π –Ω–∞ –∏–≥—Ä–∞—Ç–∞, <b>${playerName}</b>!<br><br>
    –†–µ–∑—É–ª—Ç–∞—Ç: <b>${score}</b> –æ—Ç <b>${questions.length}</b> (${percent}%).<br><br>`;

  answersDiv.innerHTML = "";
  nextBtn.disabled = true;
  timerDisplay.textContent = "";
  currentScoreDiv.style.display = "none";

  localStorage.setItem("lastResult", JSON.stringify({
    name: playerName,
    score,
    total: questions.length,
    percent,
    date: new Date().toLocaleString('bg-BG')
  }));

  localStorage.removeItem("progress");

  qText.innerHTML += `
    <div style="display:flex; justify-content:center; gap:12px; margin-top:20px;">
      <button id="history-btn" class="yellow-btn">–ò—Å—Ç–æ—Ä–∏—è –Ω–∞ –∏–≥—Ä–∞—Ç–∞</button>
      <button id="retry-btn" class="yellow-btn">–û–ø–∏—Ç–∞–π –ø–∞–∫</button>
    </div>
  `;

  document.getElementById("history-btn").onclick = showHistoryScreen;
  document.getElementById("retry-btn").onclick = restartGame;
}

document.getElementById("close-explanation-btn").onclick = () => {
  explanationDiv.style.display = "none";
};

})();
</script>

</body>
</html>
