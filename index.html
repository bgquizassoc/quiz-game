<!doctype html>
<html lang="bg">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>‚ö° –ò–≥—Ä–∏ –Ω–∞ –ó–Ω–∞–Ω–∏—è - –°–≤–µ—Ç–∫–∞–≤–∏—á–µ–Ω –∫—É–∏–∑, –µ–ø. 1 ‚ö°</title>
<link rel="manifest" href="manifest.json">
<script>
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('service-worker.js');
}
</script>
  <style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html, body {
  width: 100%;
  height: 100%;
  overflow-x: hidden;
  overflow-y: auto;
}

body {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: flex-start;
  font-size: 18px;
  font-family: 'Segoe UI', Arial, sans-serif;
  max-width: 900px;
  margin: 0 auto;
  padding: 20px;
  background: linear-gradient(180deg, #111, #222);
  color: #f8f8f8;
  min-height: 100vh;
}

h1 {
  text-align: center;
  color: #ffd100;
  font-size: clamp(1.5em, 4vw, 2em);
  margin: 10px auto 15px auto;
  text-shadow: 0 0 5px #ffb400;
  padding: 0 10px;
  box-sizing: border-box;
  max-width: 100%;
  overflow-wrap: break-word;
}

#quiz, #start-screen, #history-screen {
  width: 100%;
  max-width: 600px;
  text-align: center;
  margin-top: 30px;
  background: rgba(255, 255, 255, 0.05);
  border-radius: 16px;
  padding: 20px;
  box-shadow: 0 0 10px rgba(255, 209, 0, 0.2);
}

#question {
  font-size: 1.4em;
  margin: 20px 0;
  font-weight: 600;
}

.answers button {
  display: block;
  width: 100%;
  margin: 10px 0;
  padding: 14px;
  border: none;
  border-radius: 10px;
  cursor: pointer;
  font-size: 1.1em;
  background: #333;
  color: #fff;
  transition: all 0.2s ease;
}

.answers button.correct {
  background: #2e7d32;
}

.answers button.wrong {
  background: #b71c1c;
}

#timer {
  text-align: center;
  font-weight: 800;
  color: #ffeb3b;
  margin: 20px 0;
  font-size: clamp(1.8em, 5vw, 2.6em);
  text-shadow: 0 0 12px #ffcc00, 0 0 20px #ffcc00;
  letter-spacing: 2px;
  transition: color 0.3s ease, text-shadow 0.3s ease;
}

#timer.warning {
  color: #ff4c4c;
  text-shadow: 0 0 14px #ff0000, 0 0 25px #ff0000;
}

#status {
  margin-top: 10px;
  font-weight: bold;
  font-size: 1.1em;
  min-height: 30px;
}

#next-btn {
  margin-top: 25px;
  padding: 12px 18px;
  font-size: 1.1em;
  border: none;
  border-radius: 8px;
  background: #ffd100;
  color: #111;
  font-weight: bold;
  cursor: pointer;
  transition: all 0.2s ease;
}

#next-btn:hover {
  background: #ffcc33;
  transform: scale(1.05);
}

#last-result {
  margin-top: 15px;
  font-size: 1.1em;
  color: #ddd;
}

#history-screen {
  display: none;
  text-align: left;
}

.history-question {
  margin-bottom: 25px;
  padding-bottom: 15px;
  border-bottom: 1px solid #444;
}

.history-answer {
  padding: 8px 12px;
  margin: 4px 0;
  border-radius: 8px;
  font-size: 1.05em;
}

.correct {
  background: #2e7d32 !important;
}

.wrong {
  background: #b71c1c !important;
}
  </style>
</head>

<body>
<h1> –ò–≥—Ä–∏ –Ω–∞ –ó–Ω–∞–Ω–∏—è <br> ‚ö° –°–≤–µ—Ç–∫–∞–≤–∏—á–µ–Ω –∫—É–∏–∑ ‚ö° <br> ‚ö° –µ–ø–∏–∑–æ–¥ 1 ‚ö°</h1>

<div id="start-screen">
  <p>–í—ä–≤–µ–¥–µ—Ç–µ –í–∞—à–µ—Ç–æ –∏–º–µ:</p>
  <input type="text" id="player-name" placeholder="–ò–º–µ ..." />
  <br>
  <button class="start" id="start-btn">–ó–∞–ø–æ—á–Ω–∏!</button>
  <br>
  <button class="show" id="show-last-btn">–ü–æ–∫–∞–∂–∏ –ø–æ—Å–ª–µ–¥–µ–Ω —Ä–µ–∑—É–ª—Ç–∞—Ç</button>
  <div id="last-result" style="margin-top:20px;"></div>
</div>

<div id="quiz" style="display:none;">
  <div id="timer">–û—Å—Ç–∞–≤–∞—â–æ –≤—Ä–µ–º–µ: 20 —Å–µ–∫.</div>
  <div id="question"></div>
  <div id="answers" class="answers"></div>
  <div id="status"></div>

  <div id="running-score" style="margin-top:15px; font-size:1.2em; font-weight:bold;"></div>

  <button id="next-btn" disabled>–°–ª–µ–¥–≤–∞—â –≤—ä–ø—Ä–æ—Å</button>
</div>

<div id="explanation" style="
    display:none;
    background: rgba(255,255,255,0.08);
    padding: 20px;
    margin-top: 20px;
    border-radius: 12px;
    max-width: 600px;
    text-align: center;">
    <div id="explanation-text" style="font-size:1.2em; margin-bottom:20px;"></div>

    <button id="next-question-btn"
        style="padding:12px 20px; font-size:1.1em; margin-right:10px;">
        –°–ª–µ–¥–≤–∞—â –≤—ä–ø—Ä–æ—Å
    </button>

    <button id="close-explanation-btn"
        style="padding:12px 20px; font-size:1.1em;">
        –ó–∞—Ç–≤–æ—Ä–∏
    </button>
</div>

<div id="history-screen"></div>
<script>
(async function () {
    const startScreen = document.getElementById('start-screen');
    const playerInput = document.getElementById('player-name');
    const startBtn = document.getElementById('start-btn');
    const showLastBtn = document.getElementById('show-last-btn');
    const lastResultDiv = document.getElementById('last-result');

    const qText = document.getElementById('question');
    const answersDiv = document.getElementById('answers');
    const nextBtn = document.getElementById('next-btn');
    const status = document.getElementById('status');
    const timerDisplay = document.getElementById('timer');
    const quizDiv = document.getElementById('quiz');
    const runningScore = document.getElementById("running-score");

    const explanationBox = document.getElementById("explanation");
    const explanationText = document.getElementById("explanation-text");
    const nextExplanationBtn = document.getElementById("next-question-btn");
    const closeExplanationBtn = document.getElementById("close-explanation-btn");

    const historyScreen = document.getElementById("history-screen");

    let playerName = '';
    let questions = [];
    let idx = 0;
    let score = 0;
    let timeLeft = 20;
    let timer;

    // üìå –∑–∞ –∏—Å—Ç–æ—Ä–∏—è: –ø–∞–∑–∏–º –º–∞—Å–∏–≤ –æ—Ç –æ—Ç–≥–æ–≤–æ—Ä–∏
    let answerHistory = [];

    // üéØ —Ç–æ—á–∫—É–≤–∞–Ω–µ –ø–æ –≥—Ä—É–ø–∏
    function getPointsForQuestion(i) {
        if (i < 8) return 1;
        if (i < 16) return 2;
        return 3;
    }

    // ===============================
    //   –ó–ê–†–ï–ñ–î–ê–ù–ï –ù–ê –í–™–ü–†–û–°–ò–¢–ï
    // ===============================
    try {
        const res = await fetch('questions.json');
        questions = await res.json();
    } catch (err) {
        qText.textContent = '–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –∑–∞—Ä–µ–∂–¥–∞–Ω–µ –Ω–∞ –≤—ä–ø—Ä–æ—Å–∏—Ç–µ.';
        console.error(err);
        return;
    }

    // ===============================
    // –ü–û–ö–ê–ó–í–ê–ù–ï –ù–ê –ü–û–°–õ–ï–î–ï–ù –†–ï–ó–£–õ–¢–ê–¢
    // ===============================
    const last = JSON.parse(localStorage.getItem('lastResult'));
    if (last) {
        lastResultDiv.innerHTML = `<b>–ü–æ—Å–ª–µ–¥–µ–Ω —Ä–µ–∑—É–ª—Ç–∞—Ç:</b><br>${last.name} ‚Äî ${last.score}/${last.total} (${last.percent}%)<br><small>${last.date}</small>`;
    }

    function normalize(s) { return String(s).trim(); }

    // ===============================
    //          –¢–ê–ô–ú–ï–†
    // ===============================
    function startTimer() {
        clearInterval(timer);
        timeLeft = 20;
        timerDisplay.textContent = `–û—Å—Ç–∞–≤–∞—â–æ –≤—Ä–µ–º–µ: ${timeLeft} —Å–µ–∫.`;
        timerDisplay.classList.remove('warning');

        timer = setInterval(() => {
            timeLeft--;
            timerDisplay.textContent = `–û—Å—Ç–∞–≤–∞—â–æ –≤—Ä–µ–º–µ: ${timeLeft} —Å–µ–∫.`;

            if (timeLeft <= 5) timerDisplay.classList.add('warning');
            else timerDisplay.classList.remove('warning');

            if (timeLeft <= 0) {
                clearInterval(timer);
                lockAnswers();
                status.textContent = '‚è∞ –í—Ä–µ–º–µ—Ç–æ –∏–∑—Ç–µ—á–µ!';
                nextBtn.disabled = false;

                answerHistory.push({
                    q: questions[idx].question,
                    answers: questions[idx].answers,
                    correct: questions[idx].correct,
                    chosen: null
                });
            }
        }, 1000);
    }

    function lockAnswers() {
        Array.from(answersDiv.children).forEach(btn => btn.disabled = true);
    }

    // ===============================
    //       –†–ï–ù–î–ï–† –ù–ê –í–™–ü–†–û–°
    // ===============================
    function renderQuestion(i) {
        const q = questions[i];
        qText.textContent = `${i + 1}. ${q.question}`;
        answersDiv.innerHTML = '';
        status.textContent = '';
        nextBtn.disabled = true;

        runningScore.textContent = `–¢–µ–∫—É—â —Ä–µ–∑—É–ª—Ç–∞—Ç: ${score} —Ç.`; 

        q.answers.forEach(ans => {
            const btn = document.createElement('button');
            btn.textContent = ans;

            btn.onclick = () => {
                lockAnswers();
                clearInterval(timer);
                const correct = normalize(q.correct);
                const chosen = normalize(ans);

                let points = getPointsForQuestion(i);

                if (chosen === correct) {
                    btn.classList.add('correct');
                    status.textContent = '‚úÖ –í–µ—Ä–µ–Ω –æ—Ç–≥–æ–≤–æ—Ä!';
                    score += points;
                } else {
                    btn.classList.add('wrong');
                    status.textContent = `‚ùå –ì—Ä–µ—à–µ–Ω. –í–µ—Ä–Ω–∏—è—Ç –æ—Ç–≥–æ–≤–æ—Ä –µ: ${q.correct}`;
                    Array.from(answersDiv.children).forEach(b => {
                        if (normalize(b.textContent) === correct) b.classList.add('correct');
                    });
                }

                runningScore.textContent = `–¢–µ–∫—É—â —Ä–µ–∑—É–ª—Ç–∞—Ç: ${score} —Ç.`;

                // üìå –∑–∞–ø–∏—Å –≤ –∏—Å—Ç–æ—Ä–∏—è—Ç–∞
                answerHistory.push({
                    q: q.question,
                    answers: q.answers,
                    correct: q.correct,
                    chosen: ans
                });

                nextBtn.disabled = false;

                // ‚¨áÔ∏è –ø–æ–∫–∞–∑–≤–∞–Ω–µ –Ω–∞ –æ–±—è—Å–Ω–µ–Ω–∏–µ
                explanationText.innerHTML = q.explanation;
                explanationBox.style.display = "block";
            };

            answersDiv.appendChild(btn);
        });

        startTimer();
    }

    // ===============================
    //   –ë—É—Ç–æ–Ω "–°–ª–µ–¥–≤–∞—â –≤—ä–ø—Ä–æ—Å"
    // ===============================
    nextBtn.addEventListener('click', () => {
        explanationBox.style.display = "none";

        idx++;
        if (idx >= questions.length) {
            finishQuiz();
            return;
        }
        renderQuestion(idx);
    });

    nextExplanationBtn.addEventListener('click', () => {
        explanationBox.style.display = "none";

        idx++;
        if (idx >= questions.length) {
            finishQuiz();
            return;
        }
        renderQuestion(idx);
    });

    closeExplanationBtn.addEventListener('click', () => {
        explanationBox.style.display = "none";
    });

    // ===============================
    //     ‚ú® –§–ò–ù–ê–õ –ù–ê –ò–ì–†–ê–¢–ê
    // ===============================
    function finishQuiz() {
        clearInterval(timer);

        quizDiv.style.display = "none";
        explanationBox.style.display = "none";

        historyScreen.style.display = "block";
        historyScreen.innerHTML = `<h2 style="text-align:center;color:#ffd100;margin-bottom:20px;">–ò—Å—Ç–æ—Ä–∏—è –Ω–∞ –∏–≥—Ä–∞—Ç–∞ ‚Äî ${playerName}</h2>`;

        answerHistory.forEach((entry, i) => {
            let div = document.createElement("div");
            div.className = "history-question";

            let html = `<div style="font-size:1.3em;margin-bottom:10px;">
                            ${i + 1}. ${entry.q}
                        </div>`;

            entry.answers.forEach(ans => {
                let cls = "";
                if (normalize(ans) === normalize(entry.correct)) cls = "correct";
                if (entry.chosen !== null && normalize(ans) === normalize(entry.chosen) && ans !== entry.correct) cls = "wrong";

                html += `<div class="history-answer ${cls}">${ans}</div>`;
            });

            div.innerHTML = html;
            historyScreen.appendChild(div);
        });

        // –∑–∞–ø–∏—Å –Ω–∞ —Ä–µ–∑—É–ª—Ç–∞—Ç–∞
        const percent = Math.round((score / (questions.length * 3)) * 100);

        localStorage.setItem("lastResult", JSON.stringify({
            name: playerName,
            score,
            total: questions.length,
            percent,
            date: new Date().toLocaleString("bg-BG")
        }));
    }

    // ===============================
    //       –°–¢–ê–†–¢ –ù–ê –ò–ì–†–ê–¢–ê
    // ===============================
    startBtn.addEventListener('click', () => {
        playerName = playerInput.value.trim();
        if (!playerName) {
            alert('–ú–æ–ª—è, –≤—ä–≤–µ–¥–µ—Ç–µ –∏–º–µ –Ω–∞ –æ—Ç–±–æ—Ä–∞.');
            return;
        }

        startScreen.style.display = 'none';
        quizDiv.style.display = 'block';
        renderQuestion(0);
    });

    showLastBtn.addEventListener('click', () => {
        const last = JSON.parse(localStorage.getItem('lastResult'));
        if (last) {
            lastResultDiv.innerHTML =
                `<b>–ü–æ—Å–ª–µ–¥–µ–Ω —Ä–µ–∑—É–ª—Ç–∞—Ç:</b><br>${last.name} ‚Äî ${last.score}/${last.total} (${last.percent}%)<br><small>${last.date}</small>`;
        } else {
            lastResultDiv.innerHTML = '–ù—è–º–∞ –∑–∞–ø–∏—Å–∞–Ω —Ä–µ–∑—É–ª—Ç–∞—Ç.';
        }
    });

})();
</script>
</body>
</html>
