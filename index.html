<!doctype html>
<html lang="bg">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>‚ö° –ò–≥—Ä–∏ –Ω–∞ –ó–Ω–∞–Ω–∏—è - –°–≤–µ—Ç–∫–∞–≤–∏—á–µ–Ω –∫—É–∏–∑, –µ–ø. 1 ‚ö°</title>

  <link rel="manifest" href="manifest.json">

  <script>
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('service-worker.js');
  }
  </script>

  <style>
  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  html, body {
    width: 100%;
    height: 100%;
    overflow-x: hidden;
    overflow-y: auto;
  }

  body {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-start;
    font-size: 18px;
    font-family: 'Segoe UI', Arial, sans-serif;
    max-width: 900px;
    margin: 0 auto;
    padding: 20px;
    background: linear-gradient(180deg, #111, #222);
    color: #f8f8f8;
    min-height: 100vh;
  }

  h1 {
    text-align: center;
    color: #ffd100;
    font-size: clamp(1.5em, 4vw, 2em);
    margin: 10px auto 15px auto;
    text-shadow: 0 0 5px #ffb400;
    padding: 0 10px;
    box-sizing: border-box;
    max-width: 100%;
    overflow-wrap: break-word;
  }

  #quiz, #start-screen {
    width: 100%;
    max-width: 600px;
    text-align: center;
    margin-top: 30px;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 16px;
    padding: 20px;
    box-shadow: 0 0 10px rgba(255, 209, 0, 0.2);
  }

  #question {
    font-size: 1.6em;
    margin: 20px 0;
    font-weight: 600;
  }

  .answers button {
    display: block;
    width: 100%;
    margin: 10px 0;
    padding: 16px;
    border: none;
    border-radius: 10px;
    cursor: pointer;
    font-size: 1.2em;
    background: #333;
    color: #fff;
    transition: all 0.2s ease;
  }

  .answers button:hover {
    background: #444;
    transform: scale(1.02);
  }

  .answers button.correct {
    background: #2e7d32;
  }

  .answers button.wrong {
    background: #b71c1c;
  }

  #timer {
    text-align: center;
    font-weight: 800;
    color: #ffeb3b;
    margin: 20px 0;
    font-size: clamp(1.8em, 5vw, 2.6em);
    text-shadow: 0 0 12px #ffcc00, 0 0 20px #ffcc00;
    letter-spacing: 2px;
    transition: color 0.3s ease, text-shadow 0.3s ease;
  }

  #timer.warning {
    color: #ff4c4c;
    text-shadow: 0 0 14px #ff0000, 0 0 25px #ff0000;
  }

  #status {
    margin-top: 10px;
    font-weight: bold;
    font-size: 1.1em;
    min-height: 30px;
  }

  #next-btn {
    margin-top: 25px;
    padding: 12px 18px;
    font-size: 1.1em;
    border: none;
    border-radius: 8px;
    background: #ffd100;
    color: #111;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.2s ease;
  }

  #next-btn:hover {
    background: #ffcc33;
    transform: scale(1.05);
  }

  input {
    padding: 10px;
    font-size: 1.1em;
    border-radius: 8px;
    border: 1px solid #ccc;
    width: 80%;
    margin-bottom: 10px;
  }

  button.start, button.show, button.continue-btn {
    margin-top: 10px;
    padding: 12px 20px;
    font-size: 1.1em;
    border-radius: 8px;
    border: none;
    background: #ffd100;
    color: #111;
    font-weight: bold;
    cursor: pointer;
    transition: 0.2s;
  }

  button.start:hover,
  button.show:hover,
  button.continue-btn:hover {
    background: #ffcc33;
    transform: scale(1.05);
  }

  #last-result {
    margin-top: 15px;
    font-size: 1.1em;
    color: #ddd;
  }

  #current-score {
    margin: 15px 0;
    font-size: 1.3em;
    color: #ffd100;
    font-weight: bold;
    display: none;
  }

  #explanation {
    display:none;
    background: rgba(255,255,255,0.08);
    padding: 20px;
    margin-top: 20px;
    border-radius: 12px;
    max-width: 600px;
    text-align: center;
  }
  </style>
</head>

<body>
  <h1> –ò–≥—Ä–∏ –Ω–∞ –ó–Ω–∞–Ω–∏—è <br> ‚ö° –°–≤–µ—Ç–∫–∞–≤–∏—á–µ–Ω –∫—É–∏–∑, –µ–ø. 1 ‚ö°</h1>

  <div id="start-screen">
    <p>–í—ä–≤–µ–¥–µ—Ç–µ –í–∞—à–µ—Ç–æ –∏–º–µ –∏–ª–∏ –∏–º–µ—Ç–æ –Ω–∞ –æ—Ç–±–æ—Ä–∞:</p>

    <input type="text" id="player-name" placeholder="–ò–º–µ ..." />

    <br>

    <button class="start" id="start-btn">–ó–∞–ø–æ—á–Ω–∏!</button>

    <br>

    <!-- üÜï –ë—É—Ç–æ–Ω: –ü—Ä–æ–¥—ä–ª–∂–∏ –Ω–µ–∑–∞–≤—ä—Ä—à–µ–Ω–∞ –∏–≥—Ä–∞ -->
    <button class="continue-btn" id="continue-btn" style="display:none;">
      –ü—Ä–æ–¥—ä–ª–∂–∏ –æ—Ç –º—è—Å—Ç–æ—Ç–æ, –∫—ä–¥–µ—Ç–æ —Å–ø—Ä—è—Ö—Ç–µ
    </button>

    <br>

    <button class="show" id="show-last-btn">–ü–æ–∫–∞–∂–∏ –ø–æ—Å–ª–µ–¥–µ–Ω —Ä–µ–∑—É–ª—Ç–∞—Ç</button>

    <div id="last-result" style="margin-top:20px;"></div>
  </div>

  <div id="quiz" style="display:none;">
    <div id="timer">–û—Å—Ç–∞–≤–∞—â–æ –≤—Ä–µ–º–µ: 20 —Å–µ–∫.</div>
    <div id="question"></div>
    <div id="answers" class="answers"></div>
    <div id="status"></div>

    <button id="next-btn" disabled>–°–ª–µ–¥–≤–∞—â –≤—ä–ø—Ä–æ—Å</button>

    <div id="current-score"></div>

  </div>

  <div id="explanation">
    <div id="explanation-text" style="font-size:1.2em; margin-bottom:20px;"></div>

    <button id="next-question-btn" style="padding:12px 20px; font-size:1.1em; margin-right:10px;">
      –°–ª–µ–¥–≤–∞—â –≤—ä–ø—Ä–æ—Å
    </button>

    <button id="close-explanation-btn" style="padding:12px 20px; font-size:1.1em;">
      –ó–∞—Ç–≤–æ—Ä–∏
    </button>
  </div>
<script>
(async function(){

  const startScreen = document.getElementById('start-screen');
  const playerInput = document.getElementById('player-name');
  const startBtn = document.getElementById('start-btn');
  const continueBtn = document.getElementById('continue-btn');
  const showLastBtn = document.getElementById('show-last-btn');
  const lastResultDiv = document.getElementById('last-result');

  const qText = document.getElementById('question');
  const answersDiv = document.getElementById('answers');
  const nextBtn = document.getElementById('next-btn');
  const status = document.getElementById('status');
  const timerDisplay = document.getElementById('timer');
  const currentScoreDiv = document.getElementById('current-score');

  const quizDiv = document.getElementById('quiz');
  const explanationDiv = document.getElementById('explanation');
  const explanationText = document.getElementById('explanation-text');

  let playerName = '';
  let questions = [];
  let idx = 0;
  let score = 0;
  let timeLeft = 20;
  let timer;

  // ============================================================
  // 1) –ó–∞—Ä–µ–∂–¥–∞–Ω–µ –Ω–∞ –≤—ä–ø—Ä–æ—Å–∏—Ç–µ
  // ============================================================
  try {
    const res = await fetch('questions.json');
    questions = await res.json();
  } catch(err) {
    qText.textContent = '–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –∑–∞—Ä–µ–∂–¥–∞–Ω–µ –Ω–∞ –≤—ä–ø—Ä–æ—Å–∏—Ç–µ.';
    console.error(err);
    return;
  }

  // ============================================================
  // 2) –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞ –ø–æ—Å–ª–µ–¥–µ–Ω —Ä–µ–∑—É–ª—Ç–∞—Ç
  // ============================================================
  const last = JSON.parse(localStorage.getItem('lastResult'));
  if (last) {
    lastResultDiv.innerHTML = 
      `<b>–ü–æ—Å–ª–µ–¥–µ–Ω —Ä–µ–∑—É–ª—Ç–∞—Ç:</b><br>${last.name} ‚Äî ${last.score}/${last.total} (${last.percent}%)<br><small>${last.date}</small>`;
  }

  // ============================================================
  // 3) –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞ –Ω–µ–∑–∞–≤—ä—Ä—à–µ–Ω–∞ –∏–≥—Ä–∞
  // ============================================================
  const saved = JSON.parse(localStorage.getItem('progress'));
  if (saved && saved.idx < questions.length) {
    continueBtn.style.display = 'inline-block';
    continueBtn.textContent = `–ü—Ä–æ–¥—ä–ª–∂–∏ –æ—Ç –º—è—Å—Ç–æ—Ç–æ, –∫—ä–¥–µ—Ç–æ —Å–ø—Ä—è—Ö—Ç–µ (–≤—ä–ø—Ä–æ—Å ${saved.idx + 1})`;
  }

  function normalize(s){ return String(s).trim(); }

  // ============================================================
  // 4) –°—Ç–∞—Ä—Ç–∏—Ä–∞–Ω–µ –Ω–∞ —Ç–∞–π–º–µ—Ä–∞
  // ============================================================
  function startTimer(){
    clearInterval(timer);
    timeLeft = 20;
    timerDisplay.textContent = `–û—Å—Ç–∞–≤–∞—â–æ –≤—Ä–µ–º–µ: ${timeLeft} —Å–µ–∫.`;
    timerDisplay.classList.remove('warning');

    timer = setInterval(()=>{
      timeLeft--;
      timerDisplay.textContent = `–û—Å—Ç–∞–≤–∞—â–æ –≤—Ä–µ–º–µ: ${timeLeft} —Å–µ–∫.`;

      if (timeLeft <= 5) timerDisplay.classList.add('warning');

      if (timeLeft <= 0) {
        clearInterval(timer);
        lockAnswers();
        status.textContent = '‚è∞ –í—Ä–µ–º–µ—Ç–æ –∏–∑—Ç–µ—á–µ!';
        nextBtn.disabled = false;
      }
    },1000);
  }

  function lockAnswers(){
    Array.from(answersDiv.children).forEach(btn => btn.disabled = true);
  }

  // ============================================================
  // 5) –†–µ–Ω–¥–∏—Ä–∞–Ω–µ –Ω–∞ –≤—ä–ø—Ä–æ—Å
  // ============================================================
  function renderQuestion(i){
    const q = questions[i];

    qText.textContent = `${i+1}. ${q.question}`;
    answersDiv.innerHTML = '';
    status.textContent = '';
    nextBtn.disabled = true;

    // —Å–∫—Ä–∏–≤–∞–º–µ —Ç–µ–∫—É—â–∏—è —Ä–µ–∑—É–ª—Ç–∞—Ç –¥–æ–∫–∞—Ç–æ –Ω–µ —Å–µ –æ—Ç–≥–æ–≤–æ—Ä–∏
    currentScoreDiv.style.display = 'none';

    q.answers.forEach(ans => {
      const btn = document.createElement('button');
      btn.textContent = ans;

      btn.onclick = ()=>{
        lockAnswers();
        clearInterval(timer);

        const correct = normalize(q.correct);
        const chosen = normalize(ans);

        if (chosen === correct) {
          btn.classList.add('correct');
          status.textContent = '‚úÖ –í–µ—Ä–µ–Ω –æ—Ç–≥–æ–≤–æ—Ä!';
          score++;
        } else {
          btn.classList.add('wrong');
          status.textContent = `‚ùå –ì—Ä–µ—à–µ–Ω. –í–µ—Ä–Ω–∏—è—Ç –æ—Ç–≥–æ–≤–æ—Ä –µ: ${q.correct}`;
          Array.from(answersDiv.children).forEach(b=>{
            if (normalize(b.textContent) === correct) b.classList.add('correct');
          });
        }

        // üü° –ü–æ–∫–∞–∑–≤–∞–º–µ –≤—Ä–µ–º–µ–Ω–Ω–∏—è —Ä–µ–∑—É–ª—Ç–∞—Ç
        currentScoreDiv.textContent = `–¢–µ–∫—É—â —Ä–µ–∑—É–ª—Ç–∞—Ç: ${score} —Ç–æ—á–∫–∏`;
        currentScoreDiv.style.display = 'block';

        // üü£ –ü–æ–∫–∞–∑–≤–∞–º–µ –æ–±—è—Å–Ω–µ–Ω–∏–µ—Ç–æ
        explanationText.innerHTML = q.explanation;
        explanationDiv.style.display = 'block';

        nextBtn.disabled = false;

        // üíæ –ó–∞–ø–∞–∑–≤–∞–º–µ –ü–†–û–ì–†–ï–°–ê
        localStorage.setItem('progress', JSON.stringify({
          name: playerName,
          idx: i,
          score: score
        }));
      };

      answersDiv.appendChild(btn);
    });

    startTimer();
  }

  // ============================================================
  // 6) –ü—Ä–æ–¥—ä–ª–∂–∏ –Ω–µ–∑–∞–≤—ä—Ä—à–µ–Ω–∞ –∏–≥—Ä–∞
  // ============================================================
  continueBtn.addEventListener('click', () => {
    playerName = saved.name;
    idx = saved.idx;
    score = saved.score;

    playerInput.value = playerName;

    startScreen.style.display = 'none';
    quizDiv.style.display = 'block';

    renderQuestion(idx);
  });

  // ============================================================
  // 7) –û–±–∏–∫–Ω–æ–≤–µ–Ω–æ —Å—Ç–∞—Ä—Ç–∏—Ä–∞–Ω–µ –Ω–∞ –∏–≥—Ä–∞
  // ============================================================
  startBtn.addEventListener('click', ()=>{
    playerName = playerInput.value.trim();
    if (!playerName) {
      alert('–ú–æ–ª—è, –≤—ä–≤–µ–¥–µ—Ç–µ –∏–º–µ –Ω–∞ –æ—Ç–±–æ—Ä–∞.');
      return;
    }

    startScreen.style.display = 'none';
    quizDiv.style.display = 'block';

    idx = 0;
    score = 0;

    // –∏–∑—á–∏—Å—Ç–≤–∞–º–µ —Å—Ç–∞—Ä –ø—Ä–æ–≥—Ä–µ—Å
    localStorage.removeItem('progress');

    renderQuestion(0);
  });

  // ============================================================
  // 8) –ë—É—Ç–æ–Ω ‚Äû–°–ª–µ–¥–≤–∞—â –≤—ä–ø—Ä–æ—Å‚Äú
  // ============================================================
  nextBtn.addEventListener('click', ()=>{
    explanationDiv.style.display = 'none';

    idx++;

    if (idx >= questions.length) {
      clearInterval(timer);

      const percent = Math.round((score / questions.length) * 100);

      qText.innerHTML =
        `üèÅ –ö—Ä–∞–π –Ω–∞ —Ç–µ—Å—Ç–∞, <b>${playerName}</b>!<br><br>` +
        `–†–µ–∑—É–ª—Ç–∞—Ç: <b>${score}</b> –æ—Ç <b>${questions.length}</b> (${percent}%).`;

      answersDiv.innerHTML = '';
      status.textContent = '';
      nextBtn.disabled = true;
      timerDisplay.textContent = '';
      currentScoreDiv.style.display = 'none';

      // üíæ –∑–∞–ø–∏—Å –Ω–∞ —Ä–µ–∑—É–ª—Ç–∞—Ç–∞
      const record = {
        name: playerName,
        score,
        total: questions.length,
        percent,
        date: new Date().toLocaleString('bg-BG')
      };
      localStorage.setItem('lastResult', JSON.stringify(record));

      // üßπ —Ç—Ä–∏–µ–º –ø—Ä–æ–≥—Ä–µ—Å–∞, –∑–∞—â–æ—Ç–æ –µ –∑–∞–≤—ä—Ä—à–µ–Ω–æ
      localStorage.removeItem('progress');

      return;
    }

    renderQuestion(idx);
  });

  // ============================================================
  // 9) –ü–æ–∫–∞–∑–≤–∞–Ω–µ –Ω–∞ –ø–æ—Å–ª–µ–¥–µ–Ω —Ä–µ–∑—É–ª—Ç–∞—Ç
  // ============================================================
  showLastBtn.addEventListener('click', ()=>{
    const last = JSON.parse(localStorage.getItem('lastResult'));
    if (last) {
      lastResultDiv.innerHTML =
        `<b>–ü–æ—Å–ª–µ–¥–µ–Ω —Ä–µ–∑—É–ª—Ç–∞—Ç:</b><br>${last.name} ‚Äî ${last.score}/${last.total} (${last.percent}%)<br><small>${last.date}</small>`;
    } else {
      lastResultDiv.innerHTML = '–ù—è–º–∞ –∑–∞–ø–∏—Å–∞–Ω —Ä–µ–∑—É–ª—Ç–∞—Ç.';
    }
  });

  // ============================================================
  // 10) –ë—É—Ç–æ–Ω–∏ –∑–∞ –æ–±—è—Å–Ω–µ–Ω–∏–µ
  // ============================================================
  document.getElementById('next-question-btn').addEventListener('click', () => {
    explanationDiv.style.display = 'none';

    idx++;
    if (idx < questions.length) {
      renderQuestion(idx);
    } else {
      clearInterval(timer);
      const percent = Math.round((score / questions.length) * 100);

      qText.innerHTML =
        `üèÅ –ö—Ä–∞–π –Ω–∞ —Ç–µ—Å—Ç–∞, <b>${playerName}</b>!<br><br>` +
        `–†–µ–∑—É–ª—Ç–∞—Ç: <b>${score}</b> –æ—Ç <b>${questions.length}</b> (${percent}%).`;

      answersDiv.innerHTML = '';
      status.textContent = '';
      nextBtn.disabled = true;
      timerDisplay.textContent = '';

      localStorage.setItem('lastResult', JSON.stringify({
        name: playerName,
        score,
        total: questions.length,
        percent,
        date: new Date().toLocaleString('bg-BG')
      }));

      localStorage.removeItem('progress');
    }
  });

  document.getElementById('close-explanation-btn').addEventListener('click', () => {
    explanationDiv.style.display = 'none';
  });

})();
</script>
